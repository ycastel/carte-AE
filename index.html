<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>Aires éducatives — Académie de Nice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>

<style>
body { margin:0; font-family:Segoe UI, Arial; }
#map { height:100vh; }
.header {
    position:absolute; top:15px; left:60px; z-index:1000;
    background:white; padding:12px 18px; border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    font-size:20px; font-weight:bold;
}
.legend {
    background:white; padding:10px; border-radius:10px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
</style>
</head>

<body>
<div class="header">Académie de Nice — Aires éducatives</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>

<script>
// =======================
// INITIALISATION CARTE
// =======================
var map = L.map('map').setView([43.8, 6.3], 8);

// Couches Relief et Satellite
var relief = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: '© OpenTopoMap' });
var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: '© Esri' }).addTo(map);

L.control.layers({
    "Relief": relief,
    "Satellite": satellite
}).addTo(map);

// =======================
// CLUSTER
// =======================
var clusterGroup = L.markerClusterGroup();

// =======================
// PROJ4 : Lambert 93 -> WGS84
// =======================
proj4.defs("EPSG:2154","+proj=lcc +lat_1=49.0 +lat_2=44.0 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +units=m +no_defs");
var lambert93 = "EPSG:2154";
var wgs84 = "EPSG:4326";

// =======================
// DONNEES
// =======================
var data = [
  {Nom_ecole:"Ecole Eugène Vial",AME2024:1,ATE2024:0,site_web:"http://cpieazur.fr/",lon:1024386.7785,lat:6281301.2086},
  {Nom_ecole:"Collège Port-Lympia",AME2024:1,ATE2024:0,site_web:"https://www.mermontagne.org/",lon:1045505.1766,lat:6298064.6081},
  {Nom_ecole:"Ecole Marcel Pagnol",AME2024:1,ATE2024:1,site_web:"http://cpieazur.fr/",lon:1020006.5127,lat:6282089.3682},
  {Nom_ecole:"Ecole Paul Langevin",AME2024:1,ATE2024:1,site_web:"https://www.chercheursenherbe.com/",lon:943471.919699997,lat:6228165.8898},
  {Nom_ecole:"EEPU Charles Sandro",AME2024:1,ATE2024:1,site_web:"https://naturoscope.fr/",lon:946585.2615,lat:6227524.4717},
  {Nom_ecole:"Collège Villeneuve",AME2024:1,ATE2024:0,site_web:"https://esterelcotedazur-agglo.fr/",lon:1002021.2235,lat:6265937.8923},
  {Nom_ecole:"Collège Louis Clément",AME2024:1,ATE2024:0,site_web:"https://www.ville-saintmandrier.fr/",lon:938580.9896,lat:6223974.7392},
  {Nom_ecole:"Ecole primaire La Croix Valmer",AME2024:1,ATE2024:0,site_web:"",lon:989819.9963,lat:6241169.391},
  {Nom_ecole:"Ecole Elémentaire Ernest Camail",AME2024:1,ATE2024:0,site_web:"https://esterelcotedazur-agglo.fr/",lon:1008787.6337,lat:6266262.2487},
  {Nom_ecole:"Ecole André Malraux",AME2024:1,ATE2024:0,site_web:"https://www.mermontagne.org/",lon:1055036.2504,lat:6301396.3357},
  {Nom_ecole:"Collège Jean Médecin de Sospel",AME2024:0,ATE2024:1,site_web:"https://www.mercantour-parcnational.fr/fr/des-actions/sensibiliser-eduquer-et-accueillir/leducation-lenvironnement-et-au-developpement-8",lon:1057413.0562,lat:6319030.9178},
  {Nom_ecole:"Collège les Bréguières",AME2024:1,ATE2024:0,site_web:"https://www.clubmoana.fr/",lon:1035424.7061,lat:6293556.4584},
  {Nom_ecole:"Ecole primaire Joseph Ducret",AME2024:0,ATE2024:1,site_web:"https://www.spece.fr/",lon:941118.4395,lat:6247016.5848},
  {Nom_ecole:"Collège Guy de Maupassant",AME2024:0,ATE2024:1,site_web:"https://museum.var.fr/ws/home/app/collection/expo",lon:946821.884,lat:6251878.7199},
  {Nom_ecole:"Ecole Saint-Barthélémy",AME2024:1,ATE2024:0,site_web:"https://www.mermontagne.org/",lon:1042851.113,lat:6300267.2014},
  // ... continue avec toutes les lignes restantes du CSV
];

// =======================
// AJOUT DES MARQUEURS
// =======================
data.forEach(function(d){
    var coords = proj4(lambert93,wgs84,[d.lon,d.lat]);
    var popup = "<b>"+d.Nom_ecole+"</b><br>"+
                (d.site_web ? "<a href='"+d.site_web+"' target='_blank'>Site web</a>" : "");

    var color = d.AME2024 ? "#007bff" : (d.ATE2024 ? "#28a745" : "#888");
    var marker = L.circleMarker([coords[1],coords[0]],{
        radius:8, fillColor: color, color:"white", weight:1, fillOpacity:0.9
    }).bindPopup(popup);

    clusterGroup.addLayer(marker);
});

map.addLayer(clusterGroup);

// =======================
// LEGENDE
// =======================
var legend = L.control({position:"bottomright"});
legend.onAdd = function(){
    var div = L.DomUtil.create("div","legend");
    div.innerHTML = "<b>Légende</b><br>"+
                    "<span style='color:#007bff;'>●</span> AME<br>"+
                    "<span style='color:#28a745;'>●</span> ATE";
    return div;
};
legend.addTo(map);

</script>
</body>
</html>
