<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>Aires éducatives — Académie de Nice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>

<style>
body { margin:0; font-family:Segoe UI, Arial; }
#map { height:100vh; }
.header {
    position:absolute; top:15px; left:60px; z-index:1000;
    background:white; padding:12px 18px; border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    font-size:20px; font-weight:bold;
}
.legend {
    background:white; padding:10px; border-radius:10px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
</style>
</head>

<body>
<div class="header">Académie de Nice — Aires éducatives</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>
// =======================
// INITIALISATION CARTE
// =======================
var map = L.map('map').setView([43.8, 6.3], 8);

// Couches Relief et Satellite
var relief = L.tileLayer(
    'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
    { attribution: '© OpenTopoMap' }
);

var satellite = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { attribution: '© Esri' }
).addTo(map); // Carte satellite par défaut

// =======================
// CLUSTER
// =======================
var markerCluster = L.markerClusterGroup();

// =======================
// DONNEES
// =======================
var data = [
  // Chaque entrée : [Nom_ecole, Adresse, CP, Commune, AME2024, ATE2024, site_web, X, Y]
  ["Ecole Eugène Vial","11 avenue Saint-Louis","6150","Cannes",1,0,"http://cpieazur.fr/",1024386.7785,6281301.2086],
  ["Collège Port-Lympia","31 bouvelard Stalingrad","6300","Nice",1,0,"https://www.mermontagne.org/",1045505.1766,6298064.6081],
  ["Ecole Marcel Pagnol","136 avenue Maurice Chevalier","6150","Cannes",1,1,"http://cpieazur.fr/",1020006.5127,6282089.3682],
  ["Ecole Paul Langevin","237 rue Joliot Curie Ste Marguerite","83130","La Garde",1,1,"https://www.chercheursenherbe.com/",943471.919699997,6228165.8898],
  ["EEPU Charles Sandro","rue Pellegrin","83220","Le Pradet",1,1,"https://naturoscope.fr/",946585.2615,6227524.4717],
  ["Collège Villeneuve","rue de la Tourrache","83600","Fréjus",1,0,"https://esterelcotedazur-agglo.fr/",1002021.2235,6265937.8923],
  ["Collège Louis Clément","4 rue Marc Baron","83430","Saint Mandrier-sur-Mer",1,0,"https://www.ville-saintmandrier.fr/",938580.9896,6223974.7392],
  ["Ecole primaire La Croix Valmer","rue Frédéric Mistral","83420","La Croix Valmer",1,0,"",989819.9963,6241169.391],
  ["Ecole Elémentaire Ernest Camail","rue Anatole France","83530","Saint-Raphaël",1,0,"https://esterelcotedazur-agglo.fr/",1008787.6337,6266262.2487],
  ["Ecole André Malraux","6 avenue Winston Churchill","6320","Cap d'Ail",1,0,"https://www.mermontagne.org/",1055036.2504,6301396.3357],
  // … ajoute ici toutes les autres lignes converties de ton CSV …
];

// =======================
// FONCTION DE CONVERSION MERCATOR -> LAT/LON
// =======================
function mercatorToLatLng(x, y) {
    var lon = x * 180 / 20037508.34;
    var lat = 180/Math.PI * (2 * Math.atan(Math.exp(y * Math.PI / 20037508.34)) - Math.PI/2);
    return [lat, lon];
}

// =======================
// AJOUT DES MARQUEURS
// =======================
data.forEach(function(d){
    var latlng = mercatorToLatLng(d[7], d[8]);
    var popup = "<b>"+d[0]+"</b><br>"+d[1]+"<br>"+d[2]+" "+d[3]+"<br>"+(d[6] ? "<a href='"+d[6]+"' target='_blank'>Site web</a>" : "");
    
    var color = (d[4] === 1) ? "#007bff" : (d[5] === 1) ? "#28a745" : "#888888";
    var marker = L.circleMarker(latlng, {
        radius:8, fillColor: color, color:"white", weight:1, fillOpacity:0.9
    });
    marker.bindPopup(popup);
    markerCluster.addLayer(marker);
});

map.addLayer(markerCluster);

// =======================
// LEGENDE
// =======================
var legend = L.control({position:"bottomright"});
legend.onAdd = function(){
    var div = L.DomUtil.create("div","legend");
    div.innerHTML = "<b>Légende</b><br>"+
                    "<span style='color:#007bff;'>●</span> AME<br>"+
                    "<span style='color:#28a745;'>●</span> ATE";
    return div;
};
legend.addTo(map);

</script>
</body>
</html>
